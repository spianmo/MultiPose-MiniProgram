"use strict";const{platform:e}=wx.getSystemInfoSync(),t=/\.(txt|json|html|txt|csv)/;function s(e,t){let r=t.header||{};return r=Object.keys(r).reduce(((e,t)=>(e[t.toLowerCase()]=r[t],e)),{}),{ok:1==(t.statusCode/200|0),status:t.statusCode,statusText:t.statusCode,url:e,clone:()=>s(e,t),text:()=>Promise.resolve("string"==typeof t.data?t.data:JSON.stringify(t.data)),json:()=>{if("object"==typeof t.data)return Promise.resolve(t.data);let e={};try{e=JSON.parse(t.data)}catch(s){console.error(s)}return Promise.resolve(e)},arrayBuffer:()=>Promise.resolve(t.data),headers:{keys:()=>Object.keys(r),entries:()=>{const e=[];for(const t in r)r.hasOwnProperty(t)&&e.push([t,r[t]]);return e},get:e=>r[e.toLowerCase()],has:e=>e.toLowerCase()in r}}}exports.fetchFunc=function(r,o){o=o||{};const a=r.match(t)?"text":"arraybuffer",n="arraybuffer"===a&&"ios"===e;return console.log("fetch start",r),new Promise(((e,t)=>{let c=!1;const u=function(t){if(!c)return console.log("fetch done",r),c=!0,e(s(r,t))};wx.request({url:r,method:o.method||"GET",data:o.body,header:o.headers,dataType:a,responseType:a,enableCache:!0,success:u,fail:t}),n&&setTimeout((function(){wx.request({url:r,method:o.method||"GET",data:o.body,header:o.headers,dataType:a,responseType:a,enableCache:!0,success:u,fail:t})}),200)}))};
